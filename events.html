<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Whendle ‚Äî Events (Eventle)</title>
<meta name="description" content="Guess the year of major historical events. Learn as you play. 50% of ad revenue donated to Wikipedia.">
<meta property="og:title" content="Whendle ‚Äî Events (Eventle)">
<meta property="og:description" content="Guess the year of major historical events.">
<meta property="og:type" content="website">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/3/3f/Berlin_Wall_Brandenburger_Tor.jpg">
<meta name="twitter:card" content="summary_large_image">
<style>
  :root {
    --bg: #0f1115; --card: #151923; --text: #e8ecf1; --muted: #9aa3b2;
    --green: #22c55e; --amber: #f59e0b; --red: #ef4444; --accent: #60a5fa;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 900px at 20% -10%, #1b2130 0%, var(--bg) 60%);
    color: var(--text); display: grid; place-items: start center; min-height: 100vh; padding: 16px; }
  .container { width: min(860px, 100%); }
  header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  nav a { color: var(--text); text-decoration: none; padding: 6px 10px; border-radius: 10px; border:1px solid #1f2634; background:#0f1420; }
  nav a.active { border-color:#2563eb; color:#93c5fd; }
  .card { background: linear-gradient(180deg, #1a2231, var(--card)); border:1px solid #1f2634; border-radius:16px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
  .row { display:flex; gap:16px; align-items:flex-start; flex-wrap:wrap; }
  .col { display:grid; gap:8px; flex:1 1 300px; }
  .muted { color: var(--muted); }
  img.portrait { width:100%; border-radius:12px; border:1px solid #263043; object-fit:cover; aspect-ratio:16/10; object-position:50% 18%; background:#0c0e14; }
  h1 { font-size: 1.4rem; margin: 0; }
  .controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  input[type="text"] { background:#0f1420; color:var(--text); border:1px solid #263043; padding:10px 12px; border-radius:10px; width:120px; font-size:1.1rem; letter-spacing:1px; }
  button { background: linear-gradient(180deg,#3b82f6,#2563eb); border:1px solid #1e40af; color:white; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer; }
  button.secondary { background:#0f1420; border:1px solid #263043; color:var(--text); }
  .lamps { display:flex; gap:12px; font-weight:700; }
  .lamp { display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; }
  .lamp.green { background: rgba(34,197,94,0.1); border:1px solid rgba(34,197,94,0.35); }
  .lamp.amber { background: rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.35); }
  .lamp.red { background: rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.35); }
  .grid { display:grid; gap:8px; margin-top:12px; }
  .guess-row { display:grid; align-items:center; gap:10px; padding:10px;
    grid-template-columns:auto 1fr auto; border:1px solid #20283a; border-radius:12px; background:#0e1320; }
  .year { font-weight:800; letter-spacing:1px; }
  .hint { min-width:120px; text-align:left; color:var(--muted); font-size:.9rem; }
  .status { margin-top:10px; font-weight:700; }
  .success { color: var(--green); } .error { color: var(--red); }
  .footer { margin-top: 20px; font-size:.9rem; color:var(--muted); text-align:center; }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üìÖ Whendle ‚Äî Events (Eventle)</h1>
    <nav>
      <a href="/index.html">Births</a>
      <a class="active" href="/events.html">Events</a>
    </nav>
  </header>

  <div class="card">
    <div class="row">
      <div class="col">
        <img class="portrait" id="portrait" alt="event image" src="">
      </div>
      <div class="col">
        <div class="muted">Guess the <strong>4-digit year</strong> of this event. You have 6 tries. Lamps show counts only (üü© correct place, üü® right number wrong place, üü• not present). Optional ‚ÄúWarmer/Cooler‚Äù compares to your previous guess by absolute distance in years; ties show ‚ÄúNo change ‚óºÔ∏é‚Äù.</div>
        <div class="controls" style="margin-top:8px;">
          <label class="muted" for="mode">Mode</label>
          <select id="mode"><option>Daily</option><option>Random</option></select>
          <label><input type="checkbox" id="hintToggle" checked> Warmer/Cooler</label>
          <input id="yearInput" type="text" inputmode="numeric" pattern="\\d{4}" placeholder="e.g. 1989" maxlength="4">
          <button id="submitBtn">Submit guess</button>
          <button id="newRound" class="secondary">New round</button>
        </div>
        <div id="status" class="status"></div>
        <div id="history" class="grid"></div>
      </div>
    </div>
  </div>

  <div id="reveal" class="card" style="display:none; margin-top:12px;">
    <div style="font-size:.9rem; background:#0f1420; border:1px solid #1f2634; color:var(--muted); padding:6px 10px; border-radius:999px; display:inline-block;">About this event</div>
    <div id="summary" class="summary" style="margin-top:8px; white-space:pre-wrap; line-height:1.45;"></div>
  </div>

  <div class="footer">Whendle will always be free. <strong>50% of ad revenue</strong> donated to Wikipedia.</div>
</div>

<script>
const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><defs><linearGradient id="g" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#1a2231"/><stop offset="100%" stop-color="#0e1320"/></linearGradient></defs><rect width="100%" height="100%" fill="url(#g)"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa3b2" font-family="Arial" font-size="42">Image unavailable</text></svg>`);

const EVENTS = [
  { name: "Fall of the Berlin Wall", year: 1989, img: "https://upload.wikimedia.org/wikipedia/commons/3/3f/Berlin_Wall_Brandenburger_Tor.jpg",
    summary: "The Berlin Wall fell in 1989, leading to German reunification and symbolizing the end of the Cold War." },
  { name: "First Moon Landing (Apollo 11)", year: 1969, img: "https://upload.wikimedia.org/wikipedia/commons/a/a1/Aldrin_Apollo_11.jpg",
    summary: "Apollo 11 landed on the Moon in 1969; Neil Armstrong and Buzz Aldrin walked on the lunar surface." },
  { name: "World Wide Web proposed", year: 1989, img: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Tim_Berners-Lee%2C_Vienna_2009.jpg",
    summary: "Tim Berners-Lee proposed the World Wide Web in 1989 at CERN, leading to the modern web." },
  { name: "First Powered Flight (Wright Brothers)", year: 1903, img: "https://upload.wikimedia.org/wikipedia/commons/a/a3/First_flight2.jpg",
    summary: "In 1903, the Wright brothers achieved the first powered, controlled flight at Kitty Hawk." },
  { name: "Penicillin discovered", year: 1928, img: "https://upload.wikimedia.org/wikipedia/commons/4/4c/Alexander_Fleming_%281952%29.jpg",
    summary: "Alexander Fleming discovered penicillin in 1928, leading to the antibiotic era." },
  { name: "DNA double helix published", year: 1953, img: "https://upload.wikimedia.org/wikipedia/commons/5/5c/DNA_model.png",
    summary: "Watson and Crick published the structure of DNA in 1953, based on crucial data from Rosalind Franklin and Maurice Wilkins." },
  { name: "Sputnik 1 launched", year: 1957, img: "https://upload.wikimedia.org/wikipedia/commons/7/74/Sputnik_asm.jpg",
    summary: "The Soviet Union launched Sputnik 1 in 1957, the first artificial Earth satellite." },
  { name: "Magna Carta sealed", year: 1215, img: "https://upload.wikimedia.org/wikipedia/commons/1/13/Magna_Carta_%28British_Library_Cotton_MS_Augustus_II.106%29.jpg",
    summary: "In 1215, Magna Carta limited the powers of the English king and influenced constitutional law." },
  { name: "American Declaration of Independence", year: 1776, img: "https://upload.wikimedia.org/wikipedia/commons/6/6b/US_Declaration_of_Independence.jpg",
    summary: "The United States declared independence from Britain in 1776." },
  { name: "French Revolution begins (Storming of the Bastille)", year: 1789, img: "https://upload.wikimedia.org/wikipedia/commons/1/10/Prise_de_la_Bastille.jpg",
    summary: "In 1789, the storming of the Bastille marked the start of the French Revolution." },
  { name: "Columbus reaches the Americas", year: 1492, img: "https://upload.wikimedia.org/wikipedia/commons/7/7d/Columbus_Taking_Possession_of_the_New_Country.jpg",
    summary: "Christopher Columbus reached the Americas in 1492, initiating sustained European contact." },
  { name: "Printing press introduced in Europe (Gutenberg)", year: 1450, img: "https://upload.wikimedia.org/wikipedia/commons/3/3e/Printing_press_from_1811.jpg",
    summary: "Around 1450, Gutenberg's movable-type printing press transformed information dissemination." },
  { name: "World War I begins", year: 1914, img: "https://upload.wikimedia.org/wikipedia/commons/c/ce/German_infantry_1914.jpg",
    summary: "World War I began in 1914 following the July Crisis after the assassination of Archduke Franz Ferdinand." },
  { name: "World War II ends", year: 1945, img: "https://upload.wikimedia.org/wikipedia/commons/4/49/Times_Square%2C_New_York_City_%28LOC_80-G-404522%29.jpg",
    summary: "World War II ended in 1945 with Allied victory in Europe and the Pacific." },
  { name: "First iPhone released", year: 2007, img: "https://upload.wikimedia.org/wikipedia/commons/f/fa/IPhone_1st_Gen.svg",
    summary: "Apple released the first iPhone in 2007, catalyzing the smartphone era." }
];

function pad4(n){ return n.toString().padStart(4,"0"); }
function score(answer, guess){
  const greensMask = [0,1,2,3].map(i => answer[i] === guess[i]);
  const greens = greensMask.filter(Boolean).length;
  const remAns = {}, remGue = {};
  for (let i=0;i<4;i++){
    if (!greensMask[i]){
      remAns[answer[i]] = (remAns[answer[i]]||0)+1;
      remGue[guess[i]]  = (remGue[guess[i]]||0)+1;
    }
  }
  let ambers = 0;
  for (const d in remGue){ ambers += Math.min(remGue[d]||0, remAns[d]||0); }
  const reds = 4 - greens - ambers;
  return {green:greens, amber:ambers, red:reds};
}
function lampHTML(res){
  return `<div class="lamps">
    <span class="lamp green">üü© ${res.green}</span>
    <span class="lamp amber">üü® ${res.amber}</span>
    <span class="lamp red">üü• ${res.red}</span>
  </div>`;
}
function temperatureHint(answerYear, prevGuess, newGuess) {
  const prevAbs = Math.abs(answerYear - prevGuess);
  const currAbs = Math.abs(answerYear - newGuess);
  if (currAbs < prevAbs) return "Warmer üî•";
  if (currAbs > prevAbs) return "Cooler üßä";
  return "No change ‚óºÔ∏é";
}
function todayIndex(){
  const d = new Date();
  const seed = Number(`${d.getFullYear()}${String(d.getMonth()+1).padStart(2,"0")}${String(d.getDate()).padStart(2,"0")}`);
  return seed % EVENTS.length;
}

let state = { mode: "Daily", item: null, answer: "", guesses: [], results: [], over: false, win: false };

function setImageWithFallback(imgEl, src){
  imgEl.onerror = () => { imgEl.src = PLACEHOLDER; };
  imgEl.src = src;
}
function pickEvent(mode){
  const idx = (mode==="Daily") ? todayIndex() : Math.floor(Math.random()*EVENTS.length);
  const p = EVENTS[idx];
  state.item = p;
  state.answer = pad4(p.year);
  state.guesses = [];
  state.results = [];
  state.over = false;
  state.win = false;
  setImageWithFallback(document.getElementById("portrait"), p.img);
  document.getElementById("history").innerHTML = "";
  document.getElementById("status").textContent = "";
  document.getElementById("reveal").style.display = "none";
  document.getElementById("summary").textContent = "";
  document.title = `Whendle ‚Äî Events (${p.name})`;
}

async function fetchSummary(name, fallback){
  try {
    const url = "https://en.wikipedia.org/api/rest_v1/page/summary/" + encodeURIComponent(name);
    const resp = await fetch(url, {mode:"cors"});
    if (resp.ok){
      const data = await resp.json();
      if (data && data.extract) return data.extract;
    }
  } catch(e){}
  return fallback || "";
}

function addHistoryRow(guess, res, hint){
  const row = document.createElement("div");
  row.className = "guess-row";
  const hintText = (hint && hint.trim()) ? hint : " ";
  row.innerHTML = `<div class="year">${guess}</div>${lampHTML(res)}<span class="hint">${hintText}</span>`;
  document.getElementById("history").prepend(row);
}

async function finishRound(){
  const status = document.getElementById("status");
  if (state.win){
    status.className = "status success";
    status.textContent = `Correct! ‚Äú${state.item.name}‚Äù occurred in ${state.answer}.`;
  } else {
    status.className = "status error";
    status.textContent = `Out of tries! The correct year was ${state.answer}.`;
  }
  const reveal = document.getElementById("reveal");
  const summaryEl = document.getElementById("summary");
  const text = await fetchSummary(state.item.name, state.item.summary);
  summaryEl.textContent = text || "(No summary available.)";
  reveal.style.display = "block";
}

function submitGuess(){
  if (state.over) return;
  const inp = document.getElementById("yearInput");
  const v = (inp.value || "").trim();
  const status = document.getElementById("status");
  if (!/^\d{4}$/.test(v)){
    status.className = "status";
    status.textContent = "Please enter exactly 4 digits (e.g., 1989).";
    return;
  }
  let hint = "";
  if (document.getElementById("hintToggle").checked && state.guesses.length > 0) {
    hint = temperatureHint(Number(state.answer), Number(state.guesses[state.guesses.length-1]), Number(v));
  }
  const res = score(state.answer, v);
  state.guesses.push(v);
  state.results.push(res);
  addHistoryRow(v, res, hint);
  inp.value = "";
  if (res.green === 4){
    state.over = true; state.win = true; finishRound();
  } else if (state.guesses.length >= 6){
    state.over = true; state.win = false; finishRound();
  }
}

document.getElementById("submitBtn").addEventListener("click", submitGuess);
document.getElementById("yearInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") submitGuess(); });
document.getElementById("newRound").addEventListener("click", ()=>{ pickEvent(document.getElementById("mode").value); });
document.getElementById("mode").addEventListener("change", (e)=>{ pickEvent(e.target.value); });
pickEvent(state.mode);
</script>
</body>
</html>
